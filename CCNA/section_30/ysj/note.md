## Section 30 정리


IPv6 기초 (1/16)

1. IPv6 도입 배경

1.1 IPv4 주소 고갈
- 32비트 체계의 한계
- 전세계 IP 주소 부족 문제
- NAT로 일시적 해결 시도

1.2 NAT의 문제점
- IP 표준 모델 위반으로 보안 문제
- 특정 애플리케이션 동작 오류
- 멀티미디어 통신 제한
- Note: 상위 계층에서는 NAT를 모르므로, 내부와 외부의 통신이 발생할 때 동작이 정상적으로 수행되지 않을 수 있다.

1.3 NAT 사용의 구체적 문제
- IP 전화 시스템 예시 상황:
  - 두 회사 간 IP 전화 통신 시도
  - 내부 주소/외부 주소 변환 필요
  - 음성 트래픽 전달 실패
  - 사설 IP 사용으로 인한 통신 제한

IPv6 주소 체계 (2/16)

2. IPv6 주소 형식

2.1 기본 구조
- 128비트 주소 체계 (IPv4는 32비트)
- X:X:X:X:X:X:X:X 형식
- 각 X는 16비트의 16진수 필드
- 필드 값: 0-9, A-F 사용

2.2 주소 단축 규칙
- 필드 앞의 0 생략 가능
  예) 0DB8 → DB8
- 연속된 0 필드는 :: 로 대체
  예) 2001:0DB8:0000:0001:0000:0000:0000:0001
      → 2001:DB8:0:1::1
- :: 는 주소당 한 번만 사용 가능

2.3 잘못된 단축 예시
- 2001::1::B (잘못된 예)
  - 원래 주소 추측 불가
  - :: 중복 사용으로 혼란 야기
    - Note: 둘 곳에 0이 얼마나 쓰이는 알 수 없기 때문이다.

IPv6 주소 유형 (3/16)

3. 글로벌 유니캐스트 주소

3.1 특징
- IPv4 공인 주소와 동일한 개념
- 2000::/3 범위 사용
- 전역적으로 라우팅 가능

3.2 할당 체계
- 일반 기업: /48 블록
- 가정: /64 블록 
- 모든 호스트 인터페이스: /64 마스크

- Note: ipv6는 할당 주소가 많으므로 관리 편의 상의 이유로 `/64`를 사용한다. 심지어 `end-to-end`에서도 `/64`를 사용한다.

3.3 서브넷 구성 예시
- 기업이 2001:10::/48 할당받음
- 16비트 서브넷 공간 사용 가능
- 최대 65,536개 서브넷
- 각 서브넷은 2001:10:10:0/64 ~ 2001:10:10:FFFF::/64

라우터 구성 기본 (4/16)

4. IPv6 라우터 기본 설정

4.1 필수 구성 요소
- ipv6 unicast-routing 활성화
- 인터페이스별 IPv6 주소 할당
- no shutdown으로 인터페이스 활성화

4.2 기본 명령어
```
Router(config)# ipv6 unicast-routing
Router(config)# interface f0/0
Router(config-if)# ipv6 address 2001:DB8:0:1::1/64
Router(config-if)# no shutdown
```

4.3 구성 확인
- show ipv6 interface brief
- show ipv6 route
- ping ipv6 [address]

EUI-64 주소 설정 (5/16)

5. EUI-64 자동 주소 생성

- Note: EUI-64는 Mac 주소를 기반으로 하므로 보안 상의 문제가 있으므로, 여러 OS는 대신 SLAAC를 사용한다.

5.1 작동 원리
- MAC 주소 기반 호스트 ID 생성
- MAC 주소 중간에 FFFE 삽입
- 7번째 비트 반전

5.2 구성 방법
```
Router(config-if)# ipv6 address 2001:DB8:0:1::/64 eui-64
```

5.3 사용 제한사항
- 라우터보다 종단 호스트에 적합
- 문제해결 어려움
- 관리상 직접 주소 할당 선호

링크 로컬 주소 (6/16)

6. 링크 로컬 주소 - ipv6의 여러 주소 유형의 구체적인 설명을 더 아래 해둠.

6.1 특징
- FE80::/10 범위 사용
- 같은 링크 내에서만 통신
- IPv6 활성화시 자동 생성

6.2 용도
- 라우터 간 통신
- 라우팅 프로토콜용
- 인접 라우터 검색

6.3 구성 예시
```
Router(config-if)# ipv6 address FE80::1 link-local
```

유니크 로컬 주소 (7/16)

7. 유니크 로컬 주소

7.1 특성
- FC00::/7 범위 사용
- IPv4 사설주소와 유사
- 조직 내부 통신용

7.2 주요 특징
- 인터넷 라우팅 불가
- /64 마스크 사용
- 자동/수동 구성 가능

멀티캐스트 주소 (8/16)

8. IPv6 멀티캐스트

8.1 브로드캐스트 대체
- IPv6는 브로드캐스트 미지원
- 멀티캐스트로 대체
- 더 효율적인 그룹 통신

8.2 주요 주소
- FF02::1 (모든 노드)
- FF05::1:3 (DHCP 서버)

SLAAC(Stateless Address Auto-configuration) (9/16)

9. 무상태 주소 자동 구성

9.1 기본 개념
- 호스트 자동 주소 구성
- 라우터 광고 기반
- DHCP 불필요

9.2 작동 과정
- 라우터가 prefix 광고
- 호스트가 주소 자동 생성
- EUI-64 또는 랜덤 ID 사용

9.3 제한사항
- DNS 정보 제공 불가 - (Note: 여전히 DHCP 필요, DHCP의 기능을 더 대체하는 기능은 아직 발전 중 or 반영이 안됨.)
- 추가 정보는 DHCPv6 필요

IPv6 라우팅 (10/16)

10. 라우팅 구성

- Note: 기존 ipv4랑 거의 동일하다. 로컬, static, 라우팅 프로토콜 등... 서브넷 마스크를 CIDR(`/`)를 써서 축약 표현을 사용함.

10.1 기본 요구사항
- ipv6 unicast-routing 활성화
- 인터페이스 주소 설정
- 라우팅 경로 구성

10.2 정적 라우팅 예시
```
Router(config)# ipv6 route 2001:DB8:0:2::/64 2001:DB8:0:1::2
Router(config)# ipv6 route ::/0 2001:DB8:0:1::1
```

10.3 경로 확인
- show ipv6 route
- show ipv6 neighbors
- ping ipv6

---

### **IPv6 주소 유형 상세 정리**

1. **글로벌 유니캐스트 주소 (Global Unicast Address)**  
   - **정의**: 인터넷 상에서 전역적으로 유효한 공개 IPv6 주소. IPv4의 공인 주소와 유사.  
   - **범위**: `2000::/3` (주소 공간의 상위 1/8 할당).  
   - **할당 체계**:  
     - **기업**: 일반적으로 `/48` 블록.  
     - **가정**: 보통 `/56` 또는 `/64`.  
     - **호스트**: 항상 **/64** 서브넷 마스크를 사용 (인터페이스 ID는 SLAAC에 의존).  
   - **구조**:  
     ```
     | Global Routing Prefix | Subnet ID | Interface ID |
     |         n bits         |  m bits   |    128-n-m   |
     ```
     - 예: `2001:0db8:85a3:0000:0000:8a2e:0370:7334`  
       - `2001:0db8:85a3` → 글로벌 라우팅 프리픽스.  
       - `0000` → 서브넷 ID.  
       - `0000:8a2e:0370:7334` → 인터페이스 ID.  

2. **링크 로컬 주소 (Link-Local Address)**  
   - **정의**: 동일 링크(Local Network Segment) 내에서만 사용 가능한 자동 생성 주소.  
   - **범위**: `FE80::/10` (즉, `FE80::`부터 `FEBF:FFFF:FFFF:FFFF:FFFF:FFFF:FFFF:FFFF`까지).  
   - **특징**:  
     - 각 인터페이스에서 **자동 생성** (프리픽스 `FE80` + 인터페이스 ID).  
     - 네트워크 연결 여부와 관계없이 항상 사용 가능.  
     - 링크 외부로의 라우팅 불가.  
   - **용도**:  
     - 라우터 간 연결 및 통신.  
     - 네이버 디스커버리 (Neighbor Discovery Protocol, NDP).  
     - 기본 게이트웨이 설정.  

3. **유니크 로컬 주소 (Unique Local Address)**  
   - **정의**: 조직 내부에서만 사용되는 사설 IPv6 주소. IPv4의 사설 주소(`192.168.x.x`, `10.x.x.x`)와 유사.  
   - **범위**: `FC00::/7`  
     - **FD00::/8**: 현재 일반적으로 사용되는 서브셋.  
   - **특징**:  
     - 인터넷에서 라우팅 불가 (주소의 고유성 보장을 위해 랜덤 생성 가능).  
     - `/64` 서브넷 마스크 필수 (SLAAC 호환성).  
     - 조직 내부에서 라우팅에 사용.  

4. **멀티캐스트 주소 (Multicast Address)**  
   - **정의**: 특정 그룹에 메시지를 전송하기 위한 IPv6 주소.  
   - **범위**: `FF00::/8`  
   - **주요 주소**:  
     - `FF02::1`: 모든 노드.  
     - `FF02::2`: 모든 라우터.  
     - `FF05::1:3`: DHCP 서버.  
   - **특징**:  
     - IPv4의 브로드캐스트 대신 사용됨.  
     - 효율적인 그룹 통신 및 서비스 간 주소 분리를 지원.  
     - 특정 기능(예: OSPF, DHCP)별로 멀티캐스트 주소 지정 가능.  

5. **브로드캐스트**  
   - **IPv6에서의 변경 사항**:  
     - IPv4의 브로드캐스트 개념이 제거됨.  
     - 대신 멀티캐스트 주소를 사용하여 특정 그룹에 데이터 전송.  
   - **장점**:  
     - 네트워크 부하 감소.  
     - 트래픽이 필요 없는 장치로 전달되지 않음.  
     - 효율적이고 서비스 중심의 데이터 분배 가능.  

### **추가 설명**  
1. **글로벌 유니캐스트 주소와 서브넷**  
   - `/64`는 SLAAC와 호환성을 위해 기본적으로 사용되며, 각 서브넷은 **2^64**개의 주소를 가질 수 있음.  
   - `/48`은 ISP가 고객에게 제공하는 기본 할당 크기.  

2. **링크 로컬 주소**  
   - 기본적으로 모든 IPv6 인터페이스에 생성되므로, IPv6 활성화 시 라우터 설정 없이도 라우터 간 통신 가능.  

3. **멀티캐스트와 브로드캐스트 비교**  
   - 브로드캐스트는 모든 노드로 데이터 전송, 네트워크 자원 낭비.  
   - 멀티캐스트는 필요한 그룹에게만 전송, 효율성 증가.  


### **요약**  
- **글로벌 유니캐스트**: 전역 유효 주소, 주로 `/64` 사용.  
- **링크 로컬**: 링크 내 자동 생성, 기본적으로 `FE80::/10`.  
- **유니크 로컬**: 조직 내부 사설 주소, `FC00::/7`.  
- **멀티캐스트**: 그룹 통신용, `FF00::/8`.  
- **브로드캐스트**: IPv6에서 제거, 멀티캐스트로 대체.  

IPv6는 설계상 주소 공간이 매우 크며, 각 유형은 명확한 용도와 효율성을 제공하도록 설계되었습니다.


---

ipv6 관련 RFC 문서

RFC 3177과 RFC 6177은 IPv6 주소 할당에 관한 권장사항을 다루고 있는 문서입니다. 두 문서의 주요 내용과 차이점은 다음과 같습니다:

RFC 3177 (2001년 발표)

- 대부분의 경우 최종 사이트에 /48 블록을 할당할 것을 권장했습니다[1][3].

- 구체적으로 /48, /64, /128의 고정된 프리픽스 길이를 권장했습니다[4].

- 단일 크기의 할당 정책(one-size-fits-all)을 제안했습니다[4].

RFC 6177 (2011년 발표)

- RFC 3177의 권장사항을 폐기하고 업데이트했습니다[2][4].

- 모든 최종 사이트에 단일 기본 할당 크기(/48 등)를 적용하는 것은 적절하지 않다고 판단했습니다[4].

- 최종 사이트의 규모와 특성에 따라 유연하게 주소 공간을 할당할 것을 권장했습니다[4].

- 고정된 경계(/48, /64, /128 등)만을 인식하는 "클래스풀 주소 지정" 방식으로의 회귀를 경계했습니다[4].

- CIDR(Classless Inter-Domain Routing)이 라우팅 프리픽스의 모든 비트에 계속 적용되어야 한다고 강조했습니다[4].

- 최종 사이트가 실제 및 계획된 사용에 맞는 충분한 주소 공간을 얻을 수 있어야 한다는 RFC 3177의 기본 원칙은 재확인했습니다[4].

요약하면, RFC 6177은 RFC 3177의 경직된 할당 정책을 수정하여 보다 유연하고 효율적인 IPv6 주소 할당을 권장하고 있습니다.

Citations:
[1] https://datatracker.ietf.org/doc/html/rfc3177
[2] https://www.rfc-editor.org/info/rfc6177
[3] https://www.rfc-editor.org/info/rfc3177
[4] https://tex2e.github.io/rfc-translater/html/rfc6177.html

---

IPv6와 관련된 주요 RFC 문서들을 다음과 같이 정리할 수 있습니다:

## 기본 사양

- RFC 8200: IPv6의 기본 사양을 정의한 문서로, RFC 2460을 대체합니다[4].

## 주소 체계

- RFC 4291: IPv6 주소 아키텍처를 정의합니다[5].
- RFC 3513: IPv6 주소 지정 아키텍처의 이전 버전입니다[5].
- RFC 3879: IPv6 주소 체계에 대한 업데이트를 포함합니다[5].

## 자동 설정

- RFC 2462: IPv6 무상태 주소 자동 설정(SLAAC)을 정의합니다[3][5].
- RFC 4862: RFC 2462를 대체하는 업데이트된 SLAAC 사양입니다[3].

## 이웃 탐색

- RFC 2461: IPv6 이웃 탐색 프로토콜을 정의합니다[3].
- RFC 4861: RFC 2461을 대체하는 업데이트된 이웃 탐색 프로토콜 사양입니다[3].

## ICMPv6

- RFC 2463: IPv6용 인터넷 제어 메시지 프로토콜(ICMPv6)을 정의합니다[3].
- RFC 4443: RFC 2463을 대체하는 업데이트된 ICMPv6 사양입니다[3][4].

## 전환 메커니즘

- RFC 4213: IPv6 호스트 및 라우터를 위한 기본 전환 메커니즘을 정의합니다[5][6].

## 모바일 IPv6

- RFC 3775: 모바일 IPv6 사양을 정의합니다[5].

## 보안

- RFC 4302: 인증 헤더(AH)를 정의합니다[5].
- RFC 4303: 캡슐화 보안 페이로드(ESP)를 정의합니다[5].
- RFC 4305: ESP와 AH를 위한 암호화 알고리즘 구현 요구사항을 명시합니다[5].

## 노드 요구사항

- RFC 6434: IPv6 노드의 요구사항을 정의하는 최신 문서입니다[6].
- RFC 4294: IPv6 노드 요구사항의 이전 버전입니다[5].

이 외에도 다양한 링크 계층 기술에 대한 IPv6 사양(이더넷, PPP, ATM 등)과 DNS, DHCPv6 등 관련 프로토콜에 대한 RFC들이 존재합니다[5][6].

Citations:
[1] https://datatracker.ietf.org/doc/html/rfc2460
[2] https://www.rfc-editor.org/rfc/rfc9637.html
[3] https://www.system.de/ipv6-rfc/
[4] https://datatracker.ietf.org/doc/html/rfc8200
[5] https://www.rfc-editor.org/rfc/rfc4294
[6] https://www.rfc-editor.org/rfc/rfc6434

---

IPv6 서브넷 마스크와 관련된 RFC 문서는 다음과 같습니다. 이들 문서에서는 IPv6 주소 할당과 서브넷 설계에 대한 세부 정보를 다룹니다.

---

### **관련 RFC 문서**

1. **[RFC 4291: IPv6 Addressing Architecture](https://www.rfc-editor.org/rfc/rfc4291)**
   - IPv6 주소 구조와 서브넷 설계에 대한 기본 정보를 제공합니다.
   - 주요 내용:
     - IPv6 주소는 128비트 길이로 구성됩니다.
     - 주소는 네트워크 부분과 인터페이스 식별자로 나뉘며, 일반적으로 `/64` 서브넷 마스크를 사용합니다.
     - 인터페이스 ID는 EUI-64 형식이나 수동 설정으로 지정됩니다.
     - `/128`은 단일 호스트를 식별할 때 사용됩니다.

2. **[RFC 6177: IPv6 Address Assignment to End Sites](https://www.rfc-editor.org/rfc/rfc6177)**
   - 최종 사용자에게 할당되는 IPv6 주소 범위에 대해 논의합니다.
   - 주요 내용:
     - 기존 권고인 `/48` 주소 블록이 너무 과할 수 있다고 지적하며, `/56`이나 `/64` 할당도 적합할 수 있다고 언급.
     - 네트워크 설계 요구에 따라 유연한 주소 할당을 권장.

3. **[RFC 5952: A Recommendation for IPv6 Address Text Representation](https://www.rfc-editor.org/rfc/rfc5952)**
   - IPv6 주소 표현 방식에 대해 설명합니다.
   - 주요 내용:
     - 서브넷 접두사 표기법 (CIDR)은 IPv6 주소에서 네트워크 크기를 지정하는 데 사용됩니다. 예: `2001:db8::/32`.
     - 불필요한 `0`은 생략 가능하며, 연속된 `0`은 `::`로 압축 가능.


### **서브넷 마스크 설명**

1. **/64**
   - **주요 용도**: 대부분의 IPv6 네트워크에서 표준 서브넷 크기로 사용됩니다.
   - 하위 64비트는 호스트 ID로 사용되며, SLAAC(Stateless Address Autoconfiguration)와 호환됩니다.
   - 한 서브넷에 약 `2^64`개의 주소 가능.

2. **/48**
   - **주요 용도**: 조직 단위로 IPv6 주소를 할당할 때 권장.
   - 한 조직에 `/48` 블록이 주어지면 65,536개의 `/64` 서브넷을 생성할 수 있음.
   - ISP가 고객에게 네트워크 블록을 제공할 때도 사용.

3. **/128**
   - **주요 용도**: 단일 인터페이스 또는 장치 식별.
   - 주로 루프백 주소나 특정 장치의 식별에 사용.


### **IPv6 서브넷 선택 고려사항**
- **/64**: 가장 일반적으로 사용되며 SLAAC와 같은 자동화 기능을 지원.
- **/48**: 대규모 네트워크 설계 시 사용.
- **/128**: 고정된 주소가 필요한 특정 장치에서 사용.

이 RFC 문서들은 인터넷 주소 구조 및 서브넷 설계와 관련된 정책 및 기술적 기준을 제공합니다. RFC 문서는 [RFC Editor 웹사이트](https://www.rfc-editor.org/)에서 무료로 열람할 수 있습니다.