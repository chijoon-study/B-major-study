## Section 12 정리

#### DNS - 도메인 이름 시스템

- 패킷은 제4계층인 전송 계층에서 TCP 또는 UDP로 구분되고, 포트 번호가 포함. 
- 그 후 제3계층인 네트워크 계층에서는 IP 주소를 처리하는데, 일반적으로 FQDN(도메인 이름)에서 IP 주소로 변환하기 위해 DNS를 사용한다.
- 네트워크 인프라를 관리하는 조직 내에서는 주로 내부 DNS 서버나 DNS 서버의 군집(클러스터)를 갖는다.
- DNS는 FQDN(Fully Qualified Domain Name)을 IP 주소로 변환해 주며, 내부 DNS 서버는 조직 내에서 호스트의 IP 주소를 관리한다. 
- 하지만 외부의 IP 주소 정보를 요청할 경우 공공 DNS 서버로 요청을 보내야 한다.
    - e.g. 1.1.1.1, 8.8.8.8
- DNS 요청은 일반적으로 UDP + 53 포트를 사용하고, 경우에 따라 TCP + 53 포트로도 전송할 수 있다.
    - TCP 사용 경우: 패킷의 크기가 크거나(여러 패킷으로 보내야 해서), 그 외 특수한 경우.
- DNS 클라이언트: DNS 서버에 질의(요청)를 보내는 역할.
- DNS 서버: 도메인 이름을 IP 주소로 변환하는 역할.

##### Cisco 실습

- 라우터를 DNS 클라이언트로 설정하는 방법:
    - ip domain-lookup: DNS 조회를 활성화.
    - ip name-server [DNS 서버 IP]: 사용할 DNS 서버를 설정.
    - ip domain-name [도메인 이름]: 기본 도메인 이름을 설정.
    - ip domain-list [도메인 접미어]: 추가 DNS 접미어를 설정.
- 라우터를 DNS 서버로 설정하는 방법:
    - ip dns server: 라우터를 DNS 서버로 설정.
    - ip host [호스트명] [IP 주소]: 도메인에 해당하는 호스트명과 IP 주소를 설정.

이러한 명령어들은 라우터가 FQDN을 IP 주소로 변환할 수 있도록 하며, 특히 라우터 간의 네트워크 테스트 시 호스트명을 사용하여 핑 테스트를 할 수 있게 해준다.

- 구체적인 실습과정 설명: https://gist.github.com/YangSiJun528/82bf47cf1bd4d4de8a77f6bcb28ca2a1

#### ARP 주소 변환 프로토콜

- ARP 작동 과정:
    - ARP 필요성: 발신자는 목적지의 IP 주소를 알고 있어 패킷을 3계층(네트워크 계층)까지 구성할 수 있지만, 2계층에서 전송을 위해 MAC 주소를 알아야 한다.
    - ARP 요청 전송: 발신자는 목적지의 MAC 주소를 모르기 때문에, 2계층의 브로드캐스트 트래픽으로 ARP 요청을 보낸다. (MAC 주소에서 브로드캐스트 주소는 `FF:FF:FF:FF:FF:FF`)
    - 수신자가 ARP 요청에 응답: 네트워크 상의 장치 중 해당되는 IP 주소 (예: `172.23.4.2`)를 가진 수신자는 자신의 MAC 주소를 포함한 ARP 응답을 보낸다. (요청에 발신자의 MAC 주소가 있음.) 이 응답은 유니캐스트로 발신자에게 직접 전달됩니다.
    - ARP 캐시에 저장: 발신자는 수신자의 MAC 주소를 받아 자신의 ARP 캐시에 저장한다. 이후 같은 수신자에게 데이터를 보낼 때는 다시 ARP 요청을 보내지 않고, 캐시에서 MAC 주소를 참조해 바로 통신할 수 있다.

- 두 호스트가 서로 다른 서브넷에 있을 때 동작:
    - 서로 다른 서브넷 간 통신에서 ARP의 역할
        - 서로 다른 서브넷에 있는 두 호스트가 통신할 때는 라우터를 통해 트래픽이 전달되어야 한다.
        - 송신자는 자신의 IP 주소와 서브넷 마스크를 사용해 목적지가 다른 서브넷에 있음을 인지하고, 기본 게이트웨이(라우터)의 MAC 주소를 알아내기 위해 ARP 요청을 보낸다.
        - ARP 요청을 받은 라우터는 자신의 MAC 주소로 응답하고, 이후 송신자는 라우터의 MAC 주소로 IP 패킷을 전달한다.
    - 라우터에서의 ARP 동작
        - 라우터는 송신자로부터 받은 IP 패킷을 목적지 서브넷으로 전달하기 전에 목적지 호스트의 MAC 주소를 알아내야 한다. 이를 위해 목적지 서브넷에서 ARP 요청을 보내 MAC 주소를 알아낸다.
        - 라우터는 이렇게 받은 MAC 주소를 사용해 최종적으로 IP 패킷을 목적지 호스트로 전달한다.
    - MAC 주소의 변경
        - 통신 중에 IP 주소는 변경되지 않지만, MAC 주소는 각 네트워크 홉(라우터를 포함한 장치)마다 변경된다. 
            - 왜냐면 IP 주소는 최종 목적지지만, MAC 주소는 최종 목적지 + 그 목적지를 위해 거쳐갈 중간 목적지(기본 게이트웨이, 다른 라우터 등)도 포함하기 때문이다.
        - 즉, 송신자에서 라우터로, 라우터에서 목적지 호스트로 갈 때마다 MAC 주소는 그에 맞게 업데이트된다.
    - 메모: 그냥 간단하게 기본 게이트웨이(라우터)가 중간 중개자 역할을 한다고 생각하면 됨.
        - 게이트웨이에 접근하기 위해서도 MAC 주소가 필요하므로 다른 HOST 처럼 ARP를 통해 게이트웨이의 MAC 주소를 구하기도 한다.
        - 생각해보니 라우터나 스위치도 MAC 주소가 있어야 했음. 스위치는 관리(원격)외에는 딱히 쓰이지 않겠지만, 라우터는 hop으로 사용되기 때문에 필요함.

- 기본 게이트웨이
    - 서로 다른 네트워크(서브넷)에 있는 장치와 통신할 때는 기본 게이트웨이가 필수적이다. 
    - 패킷을 받아 적절한 네트워크로 데이터를 전달하는 기능을 수행하며, 주로 라우터(해당 기능을 수행할 수 있는)이다.
    - 기본 게이트웨이는 NAT를 구현하는 라우터로 작동할 수 있으나, 그게 기본 게이트웨이의 필요성의 유일한 원인은 아니다.

- 강의에선 안나오는데, 생각나서 찾은 RARP
    - RARP(Reverse Address Resolution Protocol, 역방향 주소 결정 프로토콜)
    - 지금은 BOOTP(Bootstrap Protocol)와 DHCP(Dynamic Host Configuration Protocol)로 대체됨.
        - MAC 주소와 IP 주소만 처리할 수 있었고, 서브넷 마스크나 게이트웨이 정보 같은 추가적인 설정을 처리할 수 없다는 한계가 있었음.
    - RARP는 주로 디스크 없는 장치(diskless device)나 부팅 시 IP 주소를 모르는 장치들이 자신의 IP 주소를 할당받기 위해 사용되었다.

#### 패킷의 생에

- 이건 굳이 설명하기보단 그냥 강의 보는게 더 나아보임. 자막 + 2배속이면 15분도 안됨.
    - 아니면 AI 사용해서 정리한거 보던가: https://gist.github.com/YangSiJun528/82bf47cf1bd4d4de8a77f6bcb28ca2a1
    - https://www.udemy.com/course/cisco-ccna-complete-guide-korean/learn/lecture/46337711
        - 2부로, 다음 영상까지 보면됨.

## 실습

## 리뷰

- 이 부분은 내용이 좋았다. 네트워크 송수신의 기초(핵심)적인 동작을 알게 됨.
- 네트워크 통신 중 IP 주소는 고정되지만, MAC 주소가 변경된다는 건 OSI 계층에 따라서 역할이 다르다는 걸 보여주는 좋은 예시인것 같음.
    - MAC은 상대적으로 저수준이라 중간 목적지 + 최종 목적지를 표시하므로 계속 바뀌지만 IP는 고수준이라 값이 고정임.
