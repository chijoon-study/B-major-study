## Section 23 정리

## DHCP

### DHCP 개요

**DHCP**(Dynamic Host Configuration Protocol)에 대해 다루겠습니다. DHCP는 **클라이언트/서버 프로토콜**로, 호스트에 **IP 주소**, **서브넷 마스크**, **기본 게이트웨이**와 같은 네트워크 구성 정보를 자동으로 제공합니다. 

DHCP는 네트워크에 연결된 호스트가 수동 설정 없이 DHCP 서버로부터 **자동으로 IP 주소를 할당받는 방식**입니다. 이는 네트워크 관리의 번거로움을 크게 줄여줍니다.

1. **DHCP 클라이언트 설정 확인**  
   예를 들어 Windows PC의 경우 **제어판 > 네트워크 설정**에서 네트워크 어댑터 속성으로 들어가 **자동으로 IP 주소 받기**가 선택되어 있으면 해당 호스트는 DHCP 클라이언트로 설정된 상태입니다. 

2. **DHCP 작동 방식**  
   - **DHCP 탐색 (Discover):** 클라이언트가 DHCP 서버를 찾기 위해 브로드캐스트로 메시지를 보냅니다.
   - **DHCP 제안 (Offer):** 서버가 IP 주소를 포함한 정보를 제안합니다.
   - **DHCP 요청 (Request):** 클라이언트가 제안받은 IP 주소를 요청합니다.
   - **DHCP 수취 확인 (Acknowledge):** 서버가 최종적으로 확인 메시지를 보내며, 클라이언트는 IP 주소를 사용하게 됩니다.

이러한 과정을 통해 클라이언트는 필요한 네트워크 구성 정보를 자동으로 받게 됩니다.

DHCP의 장점

DHCP의 주요 이점은 **자동화**와 **오류 감소**입니다.

- **대규모 네트워크 관리**: 여러 개의 호스트에 수동으로 IP를 할당하는 대신, DHCP 서버에서 중앙 집중적으로 관리할 수 있습니다.  
- **오류 방지**: 수동 설정 시 발생할 수 있는 오타나 **IP 주소 중복** 문제를 방지할 수 있습니다.
- **DHCP 옵션 제공**: IP 주소 외에 TFTP 서버 위치와 같은 추가 정보를 DHCP 옵션으로 제공할 수 있습니다.  
- **유동적인 IP 주소 업데이트**: 무선 네트워크나 이동이 잦은 장치의 경우, 이동할 때마다 자동으로 IP 주소가 갱신되어 편리합니다.  

또한 **DHCP 릴레이 에이전트**를 통해 **다중 서브넷**을 지원할 수 있습니다. 각 서브넷에 서버를 둘 필요 없이 중앙의 DHCP 서버가 모든 서브넷에 IP 주소를 할당할 수 있게 됩니다.

DHCP 클라이언트와 고정 IP 설정

일반적으로, **데스크톱 PC나 노트북**과 같은 장치는 DHCP 클라이언트로 설정할 수 있습니다. 네트워크 상에서 IP 주소가 바뀌어도 문제가 없으므로 DHCP로 설정해도 무방합니다.

반면, **라우터**나 **스위치**, **방화벽**과 같은 네트워크 장비는 IP 주소가 **고정되어야** 하므로 DHCP 클라이언트로 설정하지 않습니다. 이 장비들은 네트워크 관리와 외부 서비스 제공에 필수적이기 때문에, IP가 변경되지 않도록 수동으로 설정합니다.

### DHCP 서버 구성: Cisco 라우터 사용법

**Cisco 라우터를 DHCP 서버로 구성**하는 방법을 소개합니다. 이 방법은 **지점 사무실** 등 소규모 네트워크에서, 추가 비용 없이 **기존 라우터를 DHCP 서버로 활용**하는 데 유용합니다.


구성 시나리오

- **네트워크 환경**: R1 라우터 (IP: 10.10.10.1/24), 서브넷 10.10.10.0/24
- **DNS 서버**: 10.10.20.10
- **DHCP 제외 주소**: 10.10.10.1~10.10.10.10


DHCP 구성 단계

1. **주소 제외 설정**
   - 일부 장치에 고정 IP를 할당하기 위해 **DHCP 범위에서 제외할 주소**를 설정합니다.
   ```plaintext
   ip dhcp excluded-address 10.10.10.1 10.10.10.10
   ```
  메모: 주로 네트워크 기반 장치인 프린터나 라우터가 해당됨. 프린터는 아마 무선 출력 기능 때문에 그런듯?

2. **DHCP 풀 구성**
   - **IP 범위 및 서브넷**을 지정하고, **기본 게이트웨이와 DNS 서버 주소**를 설정합니다.
   ```plaintext
   ip dhcp pool <이름>
   network 10.10.10.0 255.255.255.0 - dhcp 풀
   default-router 10.10.10.1  - 기본 게이트웨이
   dns-server 10.10.20.10  - dns 서버
   ```

구성 예시

1. **주소 제외** (10.10.10.1~10.10.10.10)
   ```plaintext
   config t
   ip dhcp excluded-address 10.10.10.1 10.10.10.10
   ```

2. **DHCP 풀 생성** (`Demo`라는 이름으로 구성)
   ```plaintext
   ip dhcp pool Demo
   network 10.10.10.0 255.255.255.0
   default-router 10.10.10.1
   dns-server 10.10.20.10
   ```

검증 명령어

메모: 클라이언트는 따로 지정을 안해줘도, 알아서 브로드캐스트를 통해 IP를 요청하고 할당받는다.

- **DHCP 풀 확인**: `show ip dhcp pool`  
- **할당된 IP 확인**: `show ip dhcp binding`

예를 들어, **10.10.10.11**이 **MAC 주소 D116** 클라이언트에 할당된 것을 확인할 수 있습니다.

### Cisco 라우터의 외부 DHCP 서버 지원 설정

이번 강의에서는 **Cisco 라우터가 외부 DHCP 서버를 지원**하도록 설정하는 방법을 살펴보겠습니다. 이 설정은 **다수의 서브넷을 가진 대규모 네트워크**에서 주로 사용되며, 네트워크의 중심에 **외부 DHCP 서버**를 두어 IP 할당을 관리하는 방식입니다.

시나리오 개요

- **네트워크 구성**:
  - **라우터**: R1 (인터페이스 F0/1, 10.10.10.1/24)
  - **외부 DHCP 서버**: 10.10.20.10 (DNS 서버로도 사용)
- **PC 구성**: DHCP 클라이언트로 구성된 PC2

문제점 및 해결 방안

1. **문제점**:
   - PC2가 DHCP 요청(브로드캐스트 트래픽)을 보내면, 라우터는 이 요청을 외부 서브넷으로 전달하지 않습니다. 따라서 PC2는 DHCP 서버에 도달하지 못해 IP 주소를 할당받을 수 없습니다.

2. **해결 방안**:
   - 라우터의 클라이언트 측 인터페이스에 **DHCP 릴레이 에이전트** 설정을 추가합니다.
   - **ip helper-address 명령어**를 사용하여 라우터가 DHCP 요청을 외부 서버(10.10.20.10)로 전달하게 구성합니다.

설정 절차

1. **ip helper-address 설정**:
   - 라우터에서 클라이언트와 연결된 인터페이스(F0/1)로 이동하여 다음 명령어를 입력합니다:
   ```plaintext
   config t
   interface f0/1
   ip helper-address 10.10.20.10
   ```

2. **DHCP 서버 설정**:
   - DHCP 서버에서 10.10.10.0 서브넷에 대한 IP 범위, 서브넷 마스크, 기본 게이트웨이, 그리고 DNS 서버를 설정합니다.
   - 예시 설정:
     - **IP 범위**: 10.10.10.100부터
     - **서브넷 마스크**: /24
     - **기본 게이트웨이**: 10.10.10.1
     - **DNS 서버**: 10.10.20.10


### 윈도우 / 맥 / 리눅스에서 설정하는 법 설명

별로 중요하지 않고, GUI라서 쉽게 찾을 수 있으므로 생략

### Cisco 라우터를 DHCP 클라이언트로 구성하기

이번 강의에서는 **Cisco 라우터를 DHCP 클라이언트로 구성**하는 방법을 알아보겠습니다. 보통 라우터는 **수동으로 IP 주소**를 설정하지만, **인터넷에 연결된 지점 사무실** 등에서는 외부 서비스 제공자(ISP)로부터 IP 주소를 DHCP로 할당받아야 할 때가 있습니다.

DHCP 클라이언트로 구성하는 이유

- **고정 IP 비용 절감**: 사무실에 외부에서 접근해야 하는 서버가 없고, 고정된 공인 IP 주소가 필요하지 않은 경우입니다.
- **NAT 구성**: 지점 사무실에서 내부 호스트가 인터넷에 접속할 수 있도록 **단 하나의 공인 IP 주소**만 있으면 됩니다. 이때, ISP의 DHCP 서버로부터 동적 IP 주소를 받아 NAT를 통해 인터넷에 연결하게 됩니다.

구성 절차

1. **외부 인터페이스 DHCP 설정**:
   - 라우터의 **ISP를 마주하는 외부 인터페이스**를 DHCP 클라이언트로 구성해야 합니다.
   - 예시 명령어:
     ```plaintext
     config t
     interface f0/0
     ip address dhcp
     no shutdown
     ```

2. **DHCP 임대 정보 확인**:
   - DHCP 설정 후에는 **show dhcp lease** 명령어로 할당된 IP 주소 및 임대 정보를 확인할 수 있습니다.
구성 예시

1. **인터페이스 설정**:
   - **외부 인터페이스(F0/0)**에 DHCP 주소를 할당하고 인터페이스를 활성화합니다.
     ```plaintext
     config t
     interface f0/0
     ip address dhcp
     no shutdown
     ```

2. **IP 주소 임대 확인**:
   - 설정 후 약간의 시간이 지나면 DHCP 서버에서 IP 주소가 할당됩니다.
   - `show dhcp lease` 명령어로 할당된 IP 주소와 DHCP 서버 주소를 확인합니다.
     - 할당된 IP 주소 예시: `203.0.113.2`
     - DHCP 서버 주소 예시: `203.0.113.1`

3. **인터페이스 상태 확인**:
   - `show ip int brief` 명령어로 인터페이스 상태 및 IP 할당을 다시 한번 확인할 수 있습니다.
     - F0/0 인터페이스에 할당된 DHCP IP 주소가 `203.0.113.2`임을 확인합니다.

메모: 추가 설명

회사 사무실의 컴퓨터가 DHCP 클라이언트로서 사내 DHCP 서버로부터 IP 주소를 할당받아 인터넷을 사용할 수 있는 것처럼, 
지점 사무실의 라우터도 ISP의 DHCP 서버로부터 공인 IP 주소를 할당받아 외부 인터넷과 연결될 수 있다.

외부에서 이 IP에 접근할 필요가 없는 경우에 사용된다. 

회사의 경우에는 IP를 제한해야 하니까 고정 IP를 사용하고, 비용이 들겠지만 가정용의 경우 굳이 고정 IP를 구매할 이유가 없다.

구글에서 "통신사 dhcp 임대시간" 같은 걸 검색하면 공유기 설정에 들어가서 [DHCP 설정을 변경하는 방법을 알려주는 글](https://sealplay.com/bbs/board.php?bo_table=tip&wr_id=10042)이 많다.

### 느낀점.

이제 브로드캐스트, 유니캐스트, 스위치나 라우터의 동작이 별로 낯설지 않다. 4계층 아래의 일을 공부하고 있지만, 나중에 4계층 위의(소켓 통신) 작업을 할때도 도움이 될 것이라 느낌.

사람들 IP를 서로 바꿔서 할당되다 보니까 여러 인터넷 글에서 "이미 추천된 글입니다." 같은 일이 발생하는 듯? 물론 그거만 있는건 아니겠지만, 왜 같은 집에 살지도 않는 사람들이 같은 IP를 사용할 수 있는지 이유를 알게됨.

윈도우나 맥 설정에서 DHCP 관련한거 보기만 했지, 뭐하는건지는 하나도 몰랐는데 이제 이해감.

