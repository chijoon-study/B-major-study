## Section 35 정리

1. QoS 배경과 필요성
- 과거: 음성, 영상, 데이터 네트워크가 물리적으로 분리
- 현재: 통합 네트워크로 전환 (비용 절감, 기능 향상)
- 문제점: 동일한 대역폭을 공유하면서 트래픽 간 경쟁 발생

2. 음성/영상 통화의 품질 요구조건
- 지연 시간: 150ms 이하
- 지터(지연 시간 편차): 30ms 이하
- 패킷 손실률: 1% 이하

3. 네트워크 혼잡 발생 원인
- 들어오는 트래픽 속도 > 나가는 트래픽 속도
- 예: 내부 인터페이스(100Mbps) > 외부 인터페이스(2Mbps)

4. 혼잡 해결 방법
- 대역폭 추가 (비용 증가)
- QoS 기술 활용 (우선순위 부여)
   - 음성 패킷을 대기열 앞으로 이동
   - 중요 트래픽의 지연, 지터, 손실 최소화

5. QoS 한계
- 일시적인 혼잡 완화용
- 지속적 혼잡 시에는 링크 업그레이드 필요
- 보통 링크 활용률 80% 목표로 운영

이 강의의 핵심은 통합 네트워크 환경에서 발생하는 트래픽 혼잡 문제를 QoS를 통해 효과적으로 관리하는 것입니다.

---

1. CoS (Class of Service)
- 2계층(Layer 2) QoS 표시 방식
- 802.1q 프레임 헤더의 3비트 필드 사용
- 값 범위: 0-7
   - 기본값: 0 (최선형 트래픽, Best Effort: 보장은 못하고, 네트워크 자원이 허용하는 범위 내에서 최선을 다해보긴 할게)
   - 6-7: 네트워크 제어용
   - 최대 사용 가능값: 5
- 사용 예시
   - 음성 페이로드: CoS 5
   - 통화 신호: CoS 3
CoS, 
2. DSCP (Differentiated Services Code Point)
- 3계층(Layer 3) QoS 표시 방식
- IP 헤더의 ToS 바이트 중 6비트 사용
- 값 범위: 0-63 (64개 값)
- 사용 예시
   - 음성 페이로드: DSCP 46(EF)
   - 통화 신호: DSCP 24(CS3)
   - 미션 크리티컬 데이터: DSCP 26(AF31)
   - SD 영상: DSCP 34(AF41)
   - HD 영상: CS4

3. 신뢰 범위 관리
- IP 전화기 등 신뢰할 수 있는 장치만 선별적으로 신뢰
- PC의 표시는 신뢰하지 않음
  - PC에서 오는 트래픽은 CoS 0/DSCP 0으로 강제 설정
  - 이유: 사용자가 임의로 우선순위를 높이는 것 방지
- 필요한 경우 관리자가 특정 애플리케이션/장치에 대한 예외 정책 설정

4. 중요 포인트
- 하나의 패킷이 CoS와 DSCP 값을 모두 가질 수 있음
- DSCP가 선호되는 이유: IP 헤더의 단일 바이트만 확인하면 되어 효율적
- 분류/표시만으로는 QoS 구성이 완료되지 않음
- 실제 서비스 제공을 위해서는 큐잉 설정 필요


다음과 같은 글을 보면 DSCP를 위주로 쓰는 듯? CoS는 거의 안쓰이거나 제한적으로 쓰이는 듯 하다.
https://community.cisco.com/t5/routing/when-to-use-cos-instead-of-dscp/m-p/2071709#M202684
이 글도 잘 설명해주는 듯?
https://white-polarbear.tistory.com/52 - QoS Classification and Marking

---

큐잉(혼잡 관리)에 대한 내용을 정리해드리겠습니다:

1. 큐잉의 종류
- CBWFQ (Class-Based Weighted Fair Queueing)
   - 특정 트래픽 종류에 대역폭 보장
   - 혼잡 시 지정된 대역폭 제공

- LLQ (Low Latency Queueing)
   - CBWFQ + 우선순위 큐
   - 특정 트래픽(음성/영상)에 우선순위 부여
   - 우선순위 트래픽을 대기열 앞쪽에 배치

2. MQC(모듈형 QoS 명령줄) 구성 3단계
- Class-map: 처리할 트래픽 정의
- Policy-map: 트래픽 처리 방법 지정
- Service-policy: 정책을 인터페이스에 적용

3. 대역폭 할당 예시
- 전체 대역폭: 768Kbps
- 음성 트래픽: 33%(256Kbps) - 우선순위 큐
- 통화 신호: 5% - 일반 큐
- 나머지 트래픽: fair-queue (공정한 라운드 로빈 방식)

4. 중요 특징
- Priority percent: 지정된 비율까지만 사용 가능
- Bandwidth percent: 최소 보장, 여유 있으면 추가 사용 가능
- Class-default: 지정되지 않은 모든 트래픽
- 혼잡 상황에서만 큐잉 정책이 효과 발생

5. 실제 적용 시 주의사항
- 서비스 정책을 인터페이스에 적용하는 마지막 단계 필수
- 현실에서는 더 큰 대역폭 사용

---

1. 트래픽 정형화(Shaping)와 감시(Policing)의 차이
- 정형화
   - 초과 트래픽을 통제하여 일정 속도 유지
   - 트래픽 흐름을 매끄럽게 조절
   - 주로 고객 측에서 사용
   
- 감시
   - 초과 트래픽을 폐기하거나 표기
   - 더 공격적인 방식
   - 주로 서비스 제공자 측에서 사용
   - Note: CE 라우터 쪽 인터페이스의 PE에 유입되는 트래픽에 감시 QoS 정책을 구성

2. 주요 사용 사례
- 서비스 제공자 시나리오
   - 물리적 링크: 100Mbps
   - 계약된 대역폭: 10Mbps
   - PE 라우터에서 감시 정책으로 초과 트래픽 폐기

- 기업 네트워크 사용 사례
   - Worm 트래픽 제어
   - 불필요한 트래픽(P2P, 스캐빈저 트래픽) 제한
   - DSCP 8 또는 CS1로 표시하여 관리

3. 정형화와 LLQ 결합 예시
- 전체 대역폭: 10Mbps
- 세부 할당
   - 음성: 1Mbps (우선순위)
   - 영상: 3Mbps (우선순위)
   - 데이터: 6Mbps
- 혼잡 발생 시 음성/영상 트래픽 우선 처리

4. 중요 포인트
- 트래픽 종류별로 다른 속도 설정 가능
- 정형화와 큐잉을 함께 사용하여 효과적인 트래픽 관리 가능

---

## 정리

- QoS
   - 좁은 범위로는 네트워크 상의 자원 분배, 넒은 범위로는 서비스 품질을 의미. 강의에서는 네트워크 강의이므로 좁은 범위를 의미함.

- QoS 메커니즘: QoS를 수행하는 방법
   - 큐잉: 제일 보편적인 방식. 우선순위나 여러 조건을 사용한 혼잡 관리. (중요한 것부터 먼저 처리)
   - 정형화: 초과 트래픽을 통제. 주로 고객 측에서 사용
   - 감시: 초과 트래픽을 폐기하거나 표기. 공격적인 방식. 주로 서비스 제공자 측에서 사용

- QoS가 필요한 이유
   - 여러 네트워크 망이 분리된 상태에서 통합 네트워크로 전환되어가는 중. (비용 절감, 기능 향상)
   - 동일한 대역폭을 공유하면서 트래픽 간 경쟁 문제 발생
   - 음성과 영상 패킷에는 품질 요구 조건이 있는데, 이러한 조건을 지키기 위해서는 트래픽의 우선순위를 나눠 처리할 필요성이 생김.

- (프로토콜이랑 구체적인 내용은 스킵)

