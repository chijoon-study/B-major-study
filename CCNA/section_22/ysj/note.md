## Section 22 정리

### VLAN 간 라우팅 - 개별 인터페이스를 가진 라우터

VLAN과 IP 서브넷의 연관성

- **IP 서브넷과 VLAN의 관계**:
  - LAN 캠퍼스에서 IP 서브넷과 VLAN은 일반적으로 **일대일 관계**를 형성합니다.
  - 예를 들어, **엔지니어링 팀**의 호스트가 **10.10.10.0/24 서브넷**에 속해 있다면 **VLAN 10**과 연결됩니다.
  - **영업 팀**은 **10.10.20.0/24 서브넷**에 있으며 **VLAN 20**과 연결됩니다.

- **분리된 네트워크 구성**:
  - **IP 서브넷**으로 각 호스트는 **3계층에서 분리**됩니다.
  - **VLAN**으로 각 호스트는 **2계층에서 분리**되어 **별도의 브로드캐스트 도메인**을 형성합니다.
  - 서로 다른 IP 서브넷의 호스트는 **라우터를 통해** 트래픽을 주고받아야 통신할 수 있습니다.


첫 번째 VLAN 간 라우팅 옵션: 개별 인터페이스를 가진 라우터

- **라우터의 개별 인터페이스 사용**:
  - 각 VLAN에 대해 **별도의 물리적 인터페이스**가 있는 라우터를 사용해 라우팅합니다.
  - 예시에서는 **FastEthernet 0/1**이 **엔지니어링 VLAN**의 기본 게이트웨이로, **IP 10.10.10.1**을 할당합니다.
  - **FastEthernet 0/2**는 **영업 VLAN**의 기본 게이트웨이로, **IP 10.10.20.1**을 할당합니다.

- **라우터와 스위치 구성**:
  - 각 라우터 인터페이스를 각 VLAN과 매칭하여 스위치의 액세스 포트를 구성합니다.
  - 예시에서 **FastEthernet 0/1**은 VLAN 10(엔지니어링)에, **FastEthernet 0/2**는 VLAN 20(영업)에 연결됩니다.

외부 네트워크 연결과 기본 경로 설정

- **외부 네트워크 연결**:
  - 예시 라우터에서 **FastEthernet 0/3**은 광역망과 연결되어 있으며, IP는 **203.0.113.1**입니다.
  - **정적 기본 경로**를 사용하여, **203.0.113.2**를 다음 홉으로 설정합니다.

구성 명령어

1. **라우터 구성**:
   ```plaintext
   interface FastEthernet 0/1
   ip address 10.10.10.1 255.255.255.0
   no shutdown
   
   interface FastEthernet 0/2
   ip address 10.10.20.1 255.255.255.0
   no shutdown
   
   ip route 0.0.0.0 0.0.0.0 203.0.113.2
   ```

2. **스위치 구성**:
   ```plaintext
   interface FastEthernet 0/1
   switchport mode access
   switchport access vlan 10
   
   interface FastEthernet 0/2
   switchport mode access
   switchport access vlan 20
   ```

라우팅 확인 및 검증

- **핑 테스트**:
  - 엔지니어링 VLAN의 PC에서 같은 VLAN 내 다른 PC로 **핑** 테스트.
  - 영업 VLAN의 PC로 **핑**을 시도하면 **라우팅 설정 전**에는 실패합니다.
  - 라우팅 구성 후 다시 핑을 시도하여 **성공 여부 확인**.

- **라우터 인터페이스 확인**:
  - `show ip int brief` 명령어로 인터페이스 상태를 확인하여 **Up** 상태인지 검증.

첫 번째 옵션의 한계

- **인터페이스 부족 문제**:
  - 각 VLAN에 물리적 인터페이스가 필요해, VLAN 수가 많을 경우 **인터페이스 부족 문제**가 발생할 수 있습니다.
  
- **트래픽 지연 문제**:
  - 트래픽이 물리적 케이블을 따라 라우터로 이동하여 **지연**이 발생할 수 있습니다.

### VLAN 간 라우팅 - Router on a Stick

토폴로지 구성

- 가운데 스위치가 있으며, 엔지니어링 VLAN과 영업 VLAN용 PC들이 스위치에 연결된 상태입니다. 이전에 다룬 물리적 인터페이스 방식에서는 각 VLAN에 별도의 라우터 인터페이스가 필요했습니다. 하지만 이 방식은 **라우터의 서브 인터페이스**를 활용해 동일한 물리적 인터페이스로 여러 VLAN을 연결할 수 있습니다.

1. **물리적 인터페이스 설정**  
   - 라우터의 인터페이스 **F0/1**을 사용하여 스위치와 연결합니다.  
   - IP 주소 설정은 필요 없으며, 인터페이스를 활성화하려면 `no shutdown` 명령어를 실행합니다.

2. **서브 인터페이스 생성**  
   - **F0/1.10**: 엔지니어링 VLAN (VLAN 10)에 대한 서브 인터페이스 생성
      - 명령어: `interface FastEthernet 0/1.10`
      - VLAN 태그 설정: `encapsulation dot1q 10`
      - IP 주소: `ip address 10.10.10.1 255.255.255.0`  
      - 엔지니어링 VLAN의 기본 게이트웨이 역할을 합니다.
   - **F0/1.20**: 영업 VLAN (VLAN 20)에 대한 서브 인터페이스 생성
      - 명령어: `interface FastEthernet 0/1.20`
      - VLAN 태그 설정: `encapsulation dot1q 20`
      - IP 주소: `ip address 10.10.20.1 255.255.255.0`  
      - 영업 VLAN의 기본 게이트웨이 역할을 합니다.

동작 원리

- 스위치는 라우터와의 인터페이스를 트렁크 포트로 설정하고, VLAN 태그를 붙여 라우터로 트래픽을 전송합니다. 라우터는 **Dot1q 태그**를 확인하여 각 서브 인터페이스로 트래픽을 라우팅합니다.

WAN 연결 및 정적 경로 설정

- WAN 연결을 위해 F0/2 인터페이스에 IP 주소 **203.0.113.1**을 할당하고, **203.0.113.2**를 다음 홉으로 설정합니다.
- 명령어: `ip route 0.0.0.0 0.0.0.0 203.0.113.2`

스위치 구성

- 라우터와 연결된 스위치 인터페이스도 트렁크 포트로 설정합니다.
- 명령어:
  ```plaintext
  interface FastEthernet 0/1
  switchport trunk encapsulation dot1q
  switchport mode trunk
  ```

검증 및 테스트

- 구성이 완료되면, 각 VLAN의 PC들이 서로 통신할 수 있는지 핑 테스트를 진행합니다. 라우팅 구성이 완료되면 정상적으로 통신이 이루어져야 합니다.

### VLAN 간 라우팅 - 3계층 스위치

이번 강의에서는 세 가지 VLAN 간 라우팅 방법 중 마지막인 **3계층 스위치**를 활용한 방법을 살펴봅니다. 이는 실무에서 가장 일반적으로 사용되며, 외부 라우터 없이 스위치 자체에서 라우팅을 수행할 수 있는 방식입니다.

1. 네트워크 구성과 VLAN 구분
- **토폴로지**: 엔지니어링 VLAN과 영업 VLAN에 각각의 PC가 할당된 스위치가 있습니다. 
- **VLAN 할당**:
  - 엔지니어링 VLAN(10) – 서브넷: 10.10.10.0/24
  - 영업 VLAN(20) – 서브넷: 10.10.20.0/24

두 VLAN은 서로 다른 서브넷을 사용하여 VLAN 내 통신만 가능합니다. 두 서브넷 간 통신을 위해 라우팅이 필요합니다.

2. 3계층 스위치의 역할과 SVI 설정
- **라우터 없이 스위치에서 라우팅**:
  - 3계층 스위치에서 가상 인터페이스(SVI)를 통해 라우팅을 수행할 수 있습니다.
  - VLAN 10 및 VLAN 20에 대해 각각의 SVI를 설정합니다.
- **SVI 설정 명령어**:
  - `interface vlan 10` 
    - IP 주소: `10.10.10.1` /24
  - `interface vlan 20`
    - IP 주소: `10.10.20.1` /24
  
이러한 설정을 통해 각각의 SVI가 VLAN 10과 VLAN 20의 기본 게이트웨이 역할을 수행하여, 다른 VLAN 간 트래픽을 스위치에서 직접 라우팅할 수 있습니다.

3. WAN 연결 구성과 외부 라우터의 필요성
- **WAN 라우팅을 위한 외부 라우터 필요성**:
  - 스위치에 WAN 연결을 위해 별도의 라우터가 연결됩니다. WAN 연결의 물리적 요구 사항이나 특정 기능이 스위치에서 지원되지 않을 경우, 전용 라우터를 사용해야 합니다.
  - 스위치에서 3계층 인터페이스를 통해 WAN 라우터와의 통신을 설정합니다.

- **WAN 설정 예시**:
  - 스위치에서 WAN 라우터로 연결된 인터페이스(FastEthernet0/1)에 `no switchport`를 설정해 3계층 인터페이스로 전환하고, IP 주소를 할당합니다 (`ip address 10.10.100.1 255.255.255.0`).
  - 기본 경로로 WAN 라우터 IP인 `10.10.100.2`를 지정합니다: `ip route 0.0.0.0 0.0.0.0 10.10.100.2`.

4. 라우터 설정
- **내부와 외부 인터페이스 설정**:
  - 내부 인터페이스: `FastEthernet0/1`에 `10.10.100.2` 할당
  - 외부 인터페이스: `FastEthernet0/2`에 `203.0.113.1` 할당

- **경로 설정**:
  - LAN 트래픽: `10.10.0.0 255.255.0.0` 경로를 스위치 다음 홉 `10.10.100.1`로 설정해 두 VLAN을 포함하는 단일 요약 경로 구성
  - WAN 기본 경로: `ip route 0.0.0.0 0.0.0.0 203.0.113.2` 설정

주요 고려 사항
- **성능 최적화**: 외부 라우터가 아닌 3계층 스위치 백플레인(backplane)에서 라우팅을 수행하므로 성능이 향상됩니다. 물리적 케이블을 통해 상하로 트래픽이 이동할 필요가 없습니다.
- **WAN 기능의 한계**: 스위치에서 지원하지 않는 WAN 서비스가 필요할 경우, 외부 라우터를 통해 보완할 수 있습니다.

### 궁금증

- 3계층 스위치가 여러개가 연결되어 있으면 VLAN + IP주소에 따라 라우터처럼 사용될 것 같음.
  - 이러면 라우터랑 무슨 차이가 있을까? 
  - GPT 검색 결과로는 라우터에서 WAN 연결, 다양한 포트 타입 지원, 고급 라우팅 프로토콜, 다양한 라우팅 특화 기능 등이 있어서 대체는 어렵다고 함.